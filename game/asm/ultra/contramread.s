.include "macros.inc"

# assembler directives
.set noat      # allow manual use of $at
.set noreorder # don't insert nops after branches
.set gp=64     # allow use of 64-bit general purpose registers

.section .text

.align 4

# Likely start of new file
glabel __osContRamRead
  /* 0380D0 800374D0 27BDFFA0 */     addiu $sp, $sp, -0x60
  /* 0380D4 800374D4 AFBF003C */        sw $ra, 0x3c($sp)
  /* 0380D8 800374D8 AFB60030 */        sw $s6, 0x30($sp)
  /* 0380DC 800374DC AFB5002C */        sw $s5, 0x2c($sp)
  /* 0380E0 800374E0 AFB1001C */        sw $s1, 0x1c($sp)
  /* 0380E4 800374E4 00A08825 */        or $s1, $a1, $zero
  /* 0380E8 800374E8 0080B025 */        or $s6, $a0, $zero
  /* 0380EC 800374EC AFBE0038 */        sw $fp, 0x38($sp)
  /* 0380F0 800374F0 AFB70034 */        sw $s7, 0x34($sp)
  /* 0380F4 800374F4 AFB40028 */        sw $s4, 0x28($sp)
  /* 0380F8 800374F8 AFB30024 */        sw $s3, 0x24($sp)
  /* 0380FC 800374FC AFB20020 */        sw $s2, 0x20($sp)
  /* 038100 80037500 AFB00018 */        sw $s0, 0x18($sp)
  /* 038104 80037504 AFA60068 */        sw $a2, 0x68($sp)
  /* 038108 80037508 AFA7006C */        sw $a3, 0x6c($sp)
  /* 03810C 8003750C 0C00C69C */       jal __osSiGetAccess
  /* 038110 80037510 24150002 */     addiu $s5, $zero, 2
  /* 038114 80037514 97A5006A */       lhu $a1, 0x6a($sp)
  /* 038118 80037518 3C1E8004 */       lui $fp, %hi(D_8003D5E0)
  /* 03811C 8003751C 3C17800A */       lui $s7, %hi(__osContLastCmd)
  /* 038120 80037520 3C14800A */       lui $s4, %hi(__osPfsPifRam)
  /* 038124 80037524 000570C3 */       sra $t6, $a1, 3
  /* 038128 80037528 00057940 */       sll $t7, $a1, 5
  /* 03812C 8003752C AFAF0040 */        sw $t7, 0x40($sp)
  /* 038130 80037530 AFAE0044 */        sw $t6, 0x44($sp)
  /* 038134 80037534 26940710 */     addiu $s4, $s4, %lo(__osPfsPifRam)
  /* 038138 80037538 26F7EFE0 */     addiu $s7, $s7, %lo(__osContLastCmd)
  /* 03813C 8003753C 27DED5E0 */     addiu $fp, $fp, %lo(D_8003D5E0)
  .L80037540:
  /* 038140 80037540 92F80000 */       lbu $t8, ($s7) # __osContLastCmd + 0
  /* 038144 80037544 24010002 */     addiu $at, $zero, 2
  /* 038148 80037548 97A5006A */       lhu $a1, 0x6a($sp)
  /* 03814C 8003754C 17010003 */       bne $t8, $at, .L8003755C
  /* 038150 80037550 02808025 */        or $s0, $s4, $zero
  /* 038154 80037554 8FD90000 */        lw $t9, ($fp) # D_8003D5E0 + 0
  /* 038158 80037558 12390023 */       beq $s1, $t9, .L800375E8
  .L8003755C:
  /* 03815C 8003755C 24080002 */     addiu $t0, $zero, 2
  /* 038160 80037560 A2E80000 */        sb $t0, ($s7) # __osContLastCmd + 0
  /* 038164 80037564 AFD10000 */        sw $s1, ($fp) # D_8003D5E0 + 0
  /* 038168 80037568 1A200010 */      blez $s1, .L800375AC
  /* 03816C 8003756C 00001025 */        or $v0, $zero, $zero
  /* 038170 80037570 32240003 */      andi $a0, $s1, 3
  /* 038174 80037574 10800006 */      beqz $a0, .L80037590
  /* 038178 80037578 00801825 */        or $v1, $a0, $zero
  .L8003757C:
  /* 03817C 8003757C 24420001 */     addiu $v0, $v0, 1
  /* 038180 80037580 A2000000 */        sb $zero, ($s0)
  /* 038184 80037584 1462FFFD */       bne $v1, $v0, .L8003757C
  /* 038188 80037588 26100001 */     addiu $s0, $s0, 1
  /* 03818C 8003758C 10510007 */       beq $v0, $s1, .L800375AC
  .L80037590:
  /* 038190 80037590 24420004 */     addiu $v0, $v0, 4
  /* 038194 80037594 A2000000 */        sb $zero, ($s0)
  /* 038198 80037598 A2000001 */        sb $zero, 1($s0)
  /* 03819C 8003759C A2000002 */        sb $zero, 2($s0)
  /* 0381A0 800375A0 A2000003 */        sb $zero, 3($s0)
  /* 0381A4 800375A4 1451FFFA */       bne $v0, $s1, .L80037590
  /* 0381A8 800375A8 26100004 */     addiu $s0, $s0, 4
  .L800375AC:
  /* 0381AC 800375AC 24090001 */     addiu $t1, $zero, 1
  /* 0381B0 800375B0 AE89003C */        sw $t1, 0x3c($s4) # __osPfsPifRam + 60
  /* 0381B4 800375B4 240A00FF */     addiu $t2, $zero, 0xff
  /* 0381B8 800375B8 240B0003 */     addiu $t3, $zero, 3
  /* 0381BC 800375BC 240C0021 */     addiu $t4, $zero, 0x21
  /* 0381C0 800375C0 240D0002 */     addiu $t5, $zero, 2
  /* 0381C4 800375C4 240E00FF */     addiu $t6, $zero, 0xff
  /* 0381C8 800375C8 240F00FE */     addiu $t7, $zero, 0xfe
  /* 0381CC 800375CC A20A0000 */        sb $t2, ($s0)
  /* 0381D0 800375D0 A20B0001 */        sb $t3, 1($s0)
  /* 0381D4 800375D4 A20C0002 */        sb $t4, 2($s0)
  /* 0381D8 800375D8 A20D0003 */        sb $t5, 3($s0)
  /* 0381DC 800375DC A20E0026 */        sb $t6, 0x26($s0)
  /* 0381E0 800375E0 10000002 */         b .L800375EC
  /* 0381E4 800375E4 A20F0027 */        sb $t7, 0x27($s0)
  .L800375E8:
  /* 0381E8 800375E8 02918021 */      addu $s0, $s4, $s1
  .L800375EC:
  /* 0381EC 800375EC 8FB80044 */        lw $t8, 0x44($sp)
  /* 0381F0 800375F0 30A4FFFF */      andi $a0, $a1, 0xffff
  /* 0381F4 800375F4 0C00DDC0 */       jal __osContAddressCrc
  /* 0381F8 800375F8 A2180004 */        sb $t8, 4($s0)
  /* 0381FC 800375FC 8FB90040 */        lw $t9, 0x40($sp)
  /* 038200 80037600 24040001 */     addiu $a0, $zero, 1
  /* 038204 80037604 02802825 */        or $a1, $s4, $zero
  /* 038208 80037608 00594025 */        or $t0, $v0, $t9
  /* 03820C 8003760C 0C00C9D8 */       jal __osSiRawStartDma
  /* 038210 80037610 A2080005 */        sb $t0, 5($s0)
  /* 038214 80037614 02C02025 */        or $a0, $s6, $zero
  /* 038218 80037618 00002825 */        or $a1, $zero, $zero
  /* 03821C 8003761C 0C00C084 */       jal osRecvMesg
  /* 038220 80037620 24060001 */     addiu $a2, $zero, 1
  /* 038224 80037624 00002025 */        or $a0, $zero, $zero
  /* 038228 80037628 0C00C9D8 */       jal __osSiRawStartDma
  /* 03822C 8003762C 02802825 */        or $a1, $s4, $zero
  /* 038230 80037630 02C02025 */        or $a0, $s6, $zero
  /* 038234 80037634 00002825 */        or $a1, $zero, $zero
  /* 038238 80037638 0C00C084 */       jal osRecvMesg
  /* 03823C 8003763C 24060001 */     addiu $a2, $zero, 1
  /* 038240 80037640 92130002 */       lbu $s3, 2($s0)
  /* 038244 80037644 26120006 */     addiu $s2, $s0, 6
  /* 038248 80037648 326900C0 */      andi $t1, $s3, 0xc0
  /* 03824C 8003764C 00099903 */       sra $s3, $t1, 4
  /* 038250 80037650 56600014 */      bnel $s3, $zero, .L800376A4
  /* 038254 80037654 24130001 */     addiu $s3, $zero, 1
  /* 038258 80037658 0C00DDF4 */       jal __osContDataCrc
  /* 03825C 8003765C 02402025 */        or $a0, $s2, $zero
  /* 038260 80037660 920B0026 */       lbu $t3, 0x26($s0)
  /* 038264 80037664 02402025 */        or $a0, $s2, $zero
  /* 038268 80037668 8FA5006C */        lw $a1, 0x6c($sp)
  /* 03826C 8003766C 11620008 */       beq $t3, $v0, .L80037690
  /* 038270 80037670 00000000 */       nop 
  /* 038274 80037674 02C02025 */        or $a0, $s6, $zero
  /* 038278 80037678 0C00D980 */       jal __osPfsGetStatus
  /* 03827C 8003767C 02202825 */        or $a1, $s1, $zero
  /* 038280 80037680 1440000D */      bnez $v0, .L800376B8
  /* 038284 80037684 00409825 */        or $s3, $v0, $zero
  /* 038288 80037688 10000006 */         b .L800376A4
  /* 03828C 8003768C 24130004 */     addiu $s3, $zero, 4
  .L80037690:
  /* 038290 80037690 0C00D50C */       jal _bcopy
  /* 038294 80037694 24060020 */     addiu $a2, $zero, 0x20
  /* 038298 80037698 10000003 */         b .L800376A8
  /* 03829C 8003769C 24010004 */     addiu $at, $zero, 4
  /* 0382A0 800376A0 24130001 */     addiu $s3, $zero, 1
  .L800376A4:
  /* 0382A4 800376A4 24010004 */     addiu $at, $zero, 4
  .L800376A8:
  /* 0382A8 800376A8 16610003 */       bne $s3, $at, .L800376B8
  /* 0382AC 800376AC 2AA20000 */      slti $v0, $s5, 0
  /* 0382B0 800376B0 1040FFA3 */      beqz $v0, .L80037540
  /* 0382B4 800376B4 26B5FFFF */     addiu $s5, $s5, -1
  .L800376B8:
  /* 0382B8 800376B8 0C00C6AD */       jal __osSiRelAccess
  /* 0382BC 800376BC 00000000 */       nop 
  /* 0382C0 800376C0 8FBF003C */        lw $ra, 0x3c($sp)
  /* 0382C4 800376C4 02601025 */        or $v0, $s3, $zero
  /* 0382C8 800376C8 8FB30024 */        lw $s3, 0x24($sp)
  /* 0382CC 800376CC 8FB00018 */        lw $s0, 0x18($sp)
  /* 0382D0 800376D0 8FB1001C */        lw $s1, 0x1c($sp)
  /* 0382D4 800376D4 8FB20020 */        lw $s2, 0x20($sp)
  /* 0382D8 800376D8 8FB40028 */        lw $s4, 0x28($sp)
  /* 0382DC 800376DC 8FB5002C */        lw $s5, 0x2c($sp)
  /* 0382E0 800376E0 8FB60030 */        lw $s6, 0x30($sp)
  /* 0382E4 800376E4 8FB70034 */        lw $s7, 0x34($sp)
  /* 0382E8 800376E8 8FBE0038 */        lw $fp, 0x38($sp)
  /* 0382EC 800376EC 03E00008 */        jr $ra
  /* 0382F0 800376F0 27BD0060 */     addiu $sp, $sp, 0x60

  /* 0382F4 800376F4 00000000 */       nop 
  /* 0382F8 800376F8 00000000 */       nop 
  /* 0382FC 800376FC 00000000 */       nop 
